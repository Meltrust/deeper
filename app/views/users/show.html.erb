<div class="row p0 m-0 h-100">
  <div class="col-12 col-xl-9 border-end">
    <div class="row col-12 p-0 w-auto position-relative cover-container">
      <% if @user.cover_image.attached? %>
        <%= cl_image_tag(current_user.cover_image.key, class: 'img-fluid p-0 cover-img', :opacity=>80, :effect=>"auto_brightness") %>
      <% else %>
        <img src="https://ss.jikoome.com/images/Default/default.jpg" class="img-fluid p-0 cover-img" alt="">
      <% end %>
      <% if current_user == @user %>
        <%= form_with model: @user, id: 'cover-form' do |form| %>
          <%= form.file_field :cover_image, direct_upload: true, required: true, class: "form-control form-control-sm d-none cover_form", onchange: "form.submit()"  %>
          <button id="cover-input" type="button" class="btn btn-outline-secondary btn-sm">change</button>
          <script>
            $('#cover-input').click(function(){
                          $('#user_cover_image').click();
                          // disable button
                          $(this).prop("disabled", true);
                          $('#cover-input').html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Changing...`);
                          setTimeout(function() {
                                $('#cover-input').prop('disabled', false);
                                $('#cover-input').html(`change`);
                          }, 10000);
                          $('#cover-input').prop("disabled", false);
                          });
          </script>
        <% end %>
      <% end %>
    </div>
    <header class="row">
      <nav class="nav col-12 p-0 border-bottom text-decoration-none">
        <li class="nav-item p-0 p-sm-2 p-lg-3 position-relative secondary-top-nav-items-active secondary-top-nav-items">
          <a href="#" class="nav-link nav-text-dark secondary-top-nav-items-text ms-1 ms-sm-3 ms-lg-2 black-text ms-2">DEEPS</a>
        </li>
      </nav>
    </header>
    <main class="container d-flex flex-column px-1 px-md-4">
      <div class=" p-2 p-md-5 mt-4 bg-white shadow-sm rounded ">
        <h6 class="border-bottom pb-2 mb-0 deep-text-blue fw-bold text-uppercase"><%= @user.deeps.count > 0 ? 'ALL ' + @user.fullname.split.first + "'s deeps" : (@user.fullname.split.first) + ' HAS NO DEEPS YET' %></h6>
        <section class="deeps-section-container-userprofile">
          <%= render @deeps %>
        </section>
      </div>
    </main>
  </div>
  <aside class="border border-start-0 border-top-0 border-bottom-0  col-12 col-xl-3 who-to-follow-section-container">
    <section class="row flex-column profile-stats-container mt-5 mt-lg-0">
      <div class="d-flex flex-column justify-content-center align-items-center  profile-stats-pic-items mb-1 mb-lg-0">
        <div class="d-flex flex-column justify-content-center align-items-center">
          <% if @user.photo.attached? %>
            <figure class="profile-stats-pic-container mx-3 mb-3">
              <%= cl_image_tag(@user.photo.key, class: 'rounded-circle profile-stats-pic', :width=>150, :height=>150, :gravity=>"face", :radius=>"max", :crop=>"fill") %>
            </figure>
          <% end %>
          <% if current_user == @user %>
            <%= form_with model: @user, id: 'photo-form' do |form| %>
              <%= form.file_field :photo, direct_upload: true, required: true, class: "form-control form-control-sm d-none", onchange: "form.submit()"  %>
              <button id="photo-input" type="button" class="btn btn-outline-secondary btn-sm">change</button>
              <script>
                $('#photo-input').click(function(){
                              $('#user_photo').click();
                              // disable button
                              $(this).prop("disabled", true);
                              $('#photo-input').html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Changing...`);
                              setTimeout(function() {
                                    $('#photo-input').prop('disabled', false);
                                    $('#photo-input').html(`change`);
                              }, 10000);
                              $('#photo-input').prop("disabled", false);
                              });
              </script>
            <% end %>
          <% elsif current_user.followeds.include?(@user) %>
            <%= link_to ("<i class=' position-relative fas fa-check-circle  follow-button-pic follow-button-checked'></i>").html_safe, unfollow_user_path(@user), class: 'follow-button-pic-container ', method: 'post' %>
            <!--
            <div class="follow-button-pic-container follow-button">
            <i aria-hidden="true" class=" position-relative fas fa-plus-circle  follow-button-pic "></i>
            </div>
            -->
          <% else %>
            <%= link_to ("<i class=' position-relative fas fa-plus-circle  follow-button-pic follow-button'></i>").html_safe, follow_user_path(@user), class: 'follow-button-pic-container ', method: 'post' %>
            <!--
            <div class="follow-button-pic-container follow-button">
            <i aria-hidden="true" class=" position-relative fas fa-plus-circle  follow-button-pic "></i>
            </div>
            -->
          <% end %>
        </div>
        <strong class="black-text profile-pic-fullname mt-2 text-capitalize"><%= @user.fullname %></strong>
        <div class="deep-text-dark ">@<%= @user.username %></div>
      </div>
      <div class="d-flex flex-column flex-xl-row text-darkish-white justify-content-evenly p-0 profile-stats-container-items">
        <div class="d-flex flex-column p-3 px-lg-2 p-xxl-3 align-items-center justify-content-evenly  w-100 border-start border-end">
          <div class="fw-bold black-text"><%= @user.deeps.count %></div>
          <div class="deep-text-dark-semitransparent">Deeps</div>
        </div>
        <div class="d-flex flex-column p-3 px-lg-2 p-xxl-3 align-items-center justify-content-evenly  w-100 border-start border-end">
          <div class="fw-bold black-text"><%= @user.followeds.count %></div>
          <div class="deep-text-dark-semitransparent">Following</div>
        </div>
        <div class="d-flex flex-column p-3 px-lg-2 p-xxl-3 align-items-center justify-content-evenly  w-100 border-start border-end">
          <div class="fw-bold black-text"><%= @user.followers.count %></div>
          <div class="deep-text-dark-semitransparent">Followers</div>
        </div>
      </div>
    </section>
    <header class="row">
      <nav class="nav col-12 mt-0 p-lg-0 mb-sm-3 mb-lg-0 mt-sm-2 mt-lg-0 who-to-follow-nav-borders text-decoration-none justify-content-center justify-content-lg-start text-start p-0 mt-lg-0 border-start-0">
        <li class="nav-item p-3 px-lg-3 pt-lg-3 secondary-top-nav-items-not-active position-relative secondary-top-nav-items">
          <a href="#" class="nav-link deep-text-dark-semitransparent secondary-top-nav-items-text ms-0 ms-xxl-2 "><%= (@user.followers.count) > 0 ? 'FOLLOWED BY' : 'NO FOLLOWERS YET' %></a>
        </li>
      </nav>
    </header>
    <section class="p-2 p-md-0 mt-0 mt-sm-1 mt-lg-5 who-to-follow-items ms-md-5 ms-lg-0 followed-by-section">
      <%= render @followedbysection_users %>
    </section>
  </aside>
</div>
